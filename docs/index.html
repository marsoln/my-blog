<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Marsoln 修行札记">
    

    <!--Author-->
    
        <meta name="author" content="Marsoln">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="marsoln&#39;s blog"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Marsoln 修行札记" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="marsoln&#39;s blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>marsoln&#39;s blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/my-blog/css/style.css">

</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/my-blog/">
                    首页
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/my-blog/archives">
                    归档
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/my-blog/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">marsoln's blog</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/my-blog/2018/03/15/常用指令/">
                常用指令
            </a>
        </h1>
        <div class="post-info">
            <span class="date">2018-03-15</span>
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="通用指令"><a href="#通用指令" class="headerlink" title="通用指令"></a>通用指令</h1><ul>
<li>查看占用端口<ul>
<li>sudo lsof -i :PORT 显示指定端口的占用进程</li>
<li>ps -ef | grep “xxx”  查看指定名称的进程</li>
<li>sudo kill -9 PID 结束指定进程</li>
</ul>
</li>
<li>查看磁盘占用<ul>
<li>df -h 查看根目录的挂载盘占用情况</li>
<li>du -h -d 1 PATH 查看指定目录的磁盘情况</li>
</ul>
</li>
<li>查找文件<ul>
<li>find / -name “xxx”</li>
</ul>
</li>
<li>crontab 修改默认编辑器<ul>
<li>select-editor</li>
</ul>
</li>
<li>给用户添加目录权限<ul>
<li>chown user:user DIR<ul>
<li>chmod 760 DIR</li>
</ul>
</li>
</ul>
</li>
<li>给用户添加 sudo 权限<ul>
<li>vim /etc/sudoers 然后添加权限记录</li>
</ul>
</li>
</ul>
        </div>
        <a href="/my-blog/2018/03/15/常用指令/" class="read-more">Read More</a>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/my-blog/2017/05/12/面试题/">
                有趣的面试题
            </a>
        </h1>
        <div class="post-info">
            <span class="date">2017-05-12</span>
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="在-surmon-me-上看到的一个面试题"><a href="#在-surmon-me-上看到的一个面试题" class="headerlink" title="在 surmon.me 上看到的一个面试题"></a>在 <a href="https://surmon.me/" target="_blank" rel="external">surmon.me</a> 上看到的一个面试题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> greeting = <span class="string">'My name is $&#123;name&#125;, age $&#123;age&#125;, I am a $&#123;job.jobName&#125;'</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> employee = &#123;</div><div class="line">  name: <span class="string">'XiaoMing'</span>,</div><div class="line">  age: <span class="number">11</span>,</div><div class="line">  job: &#123;</div><div class="line">    jobName: <span class="string">'designer'</span>,</div><div class="line">    jobLevel: <span class="string">'senior'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> result = greeting.render(employee)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(result) <span class="comment">// My name is XiaoMing, age 11, I am a designer</span></div></pre></td></tr></table></figure>
<p>第一时间想到的方案就是使用正则表达式匹配到对应的属性,然后根据属性名称替换为实际值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">String</span>.prototype.render = <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/\x24\x7b([\w\.]+)\x7d/g</span>, (matchStr, attrName) =&gt; &#123;</div><div class="line">    <span class="keyword">return</span> ctx[attrName]</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后问题出现了,当 <code>attrName</code> 匹配到 <code>&quot;job.jobName&quot;</code> 时,通过索引的方式取值会变成 <code>ctx[&quot;job.jobName&quot;]</code>,得到 <code>undefined</code></p>
<p>接下来,考虑拆分属性名称</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">String</span>.prototype.render = <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/\x24\x7b([\w\.]+)\x7d/g</span>, (matchStr, attrName) =&gt; &#123;</div><div class="line">    <span class="keyword">let</span> attrPaths = attrName.split(<span class="regexp">/\./</span>)</div><div class="line">    <span class="keyword">return</span> attrPaths.reduce(<span class="function">(<span class="params">entity,attr</span>)=&gt;</span> entity[attr], ctx)</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如此一来,就会将匹配到的 <code>&quot;job.jobName&quot;</code> 拆分为 <code>&quot;job&quot;</code> 和 <code>&quot;jobName&quot;</code> 两个路径,然后调用归约函数 第一次得到 <code>ctx[&quot;job&quot;]</code> 下次一得到 <code>ctx[&quot;job&quot;][&quot;jobName&quot;]</code> 然后返回该值.</p>
<p>为了程序健壮可以再稍微完善一下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">String</span>.prototype.render = <span class="function"><span class="keyword">function</span> (<span class="params">ctx</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/\x24\x7b([\w\.]+)\x7d/g</span>, (matchStr, key) =&gt; key.split(<span class="string">'\.'</span>).reduce(<span class="function">(<span class="params">obj, attr</span>) =&gt;</span> (obj||&#123;&#125;)[attr], ctx) || matchStr)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后,看到有人给出的答案是这样的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">String</span>.prototype.render = <span class="function"><span class="keyword">function</span> (<span class="params">ctx</span>) </span>&#123;</div><div class="line">  <span class="keyword">with</span> (ctx) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(<span class="string">'`'</span> + <span class="keyword">this</span> + <span class="string">'`'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>给跪了, OTZ</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/my-blog/2017/03/02/Gitbook定制/">
                Gitbook定制
            </a>
        </h1>
        <div class="post-info">
            <span class="date">2017-03-02</span>
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="Gitbook-website-主题定制化"><a href="#Gitbook-website-主题定制化" class="headerlink" title="Gitbook website 主题定制化"></a>Gitbook website 主题定制化</h1><h2 id="Gitbook的文档组织结构的定制"><a href="#Gitbook的文档组织结构的定制" class="headerlink" title="Gitbook的文档组织结构的定制"></a>Gitbook的文档组织结构的定制</h2><p>在文档源文件根目录里的 <code>SUMMARY.md</code> 作为目录结构的载体,生成左侧的book_summary块,模板会遍历Summary中定义的parts,对于每个part里的articles通过一个递归方法去生成菜单.想要针对菜单不同层级做定制式的处理,可以从此处入手修改.</p>
<blockquote>
<p>如果只是需要做css定制而不希望改变DOM结构的话,可以借助菜单节点的 <code>data-level</code> 属性去实现.</p>
</blockquote>
<p>以default-theme为例<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">&#123;% for part in summary.parts %&#125;</div><div class="line">    &#123;% if part.title %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span>&#123;&#123; part.title &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    &#123;% elif not loop.first %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    &#123;% endif %&#125;</div><div class="line">    &#123;&#123; articles(part.articles, file, config) &#125;&#125;</div><div class="line">&#123;% endfor %&#125;</div><div class="line"></div><div class="line">&#123;% macro articles(_articles) %&#125;</div><div class="line">    &#123;% for article in _articles %&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"chapter &#123;% if article.path == file.path and not article.anchor %&#125;active&#123;% endif %&#125;"</span> <span class="attr">data-level</span>=<span class="string">"&#123;&#123; article.level &#125;&#125;"</span> &#123;% <span class="attr">if</span> <span class="attr">article.path</span> %&#125;<span class="attr">data-path</span>=<span class="string">"&#123;&#123; article.path|resolveFile &#125;&#125;"</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span></div><div class="line">            &#123;% if article.path and getPageByPath(article.path) %&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; article.path|resolveFile &#125;&#125;&#123;&#123; article.anchor &#125;&#125;"</span>&gt;</span></div><div class="line">            &#123;% elif article.url %&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; article.url &#125;&#125;"</span>&gt;</span></div><div class="line">            &#123;% else %&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span></div><div class="line">            &#123;% endif %&#125;</div><div class="line">                    &#123;% if article.level != "0" and config.pluginsConfig['theme-default'].showLevel %&#125;</div><div class="line">                        <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;&#123; article.level &#125;&#125;.<span class="tag">&lt;/<span class="name">b</span>&gt;</span></div><div class="line">                    &#123;% endif %&#125;</div><div class="line">                    &#123;&#123; article.title &#125;&#125;</div><div class="line">            &#123;% if article.path  or article.url %&#125;</div><div class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">            &#123;% else %&#125;</div><div class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">            &#123;% endif %&#125;</div><div class="line"></div><div class="line">            &#123;% if article.articles.length &gt; 0 %&#125;</div><div class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"articles"</span>&gt;</span></div><div class="line">                &#123;&#123; articles(article.articles, file, config) &#125;&#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">            &#123;% endif %&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    &#123;% endfor %&#125;</div><div class="line">&#123;% endmacro %&#125;</div></pre></td></tr></table></figure></p>
<h2 id="自定义样式"><a href="#自定义样式" class="headerlink" title="自定义样式"></a>自定义样式</h2><p>Gitbook默认的Theme提供了style自定义的功能.</p>
<p>其配置定义如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="string">"gitbook"</span>: &#123;</div><div class="line">    <span class="string">"properties"</span>: &#123;</div><div class="line">      <span class="string">"styles"</span>: &#123;</div><div class="line">        <span class="string">"type"</span>: <span class="string">"object"</span>,</div><div class="line">        <span class="string">"title"</span>: <span class="string">"Custom Stylesheets"</span>,</div><div class="line">        <span class="string">"properties"</span>: &#123;</div><div class="line">          <span class="string">"website"</span>: &#123;</div><div class="line">            <span class="string">"title"</span>: <span class="string">"Stylesheet for website output"</span>,</div><div class="line">            <span class="string">"default"</span>: <span class="string">"styles/website.css"</span></div><div class="line">          &#125;,</div><div class="line">          <span class="string">"pdf"</span>: &#123;</div><div class="line">            <span class="string">"title"</span>: <span class="string">"Stylesheet for PDF output"</span>,</div><div class="line">            <span class="string">"default"</span>: <span class="string">"styles/pdf.css"</span></div><div class="line">          &#125;,</div><div class="line">          <span class="string">"epub"</span>: &#123;</div><div class="line">            <span class="string">"title"</span>: <span class="string">"Stylesheet for ePub output"</span>,</div><div class="line">            <span class="string">"default"</span>: <span class="string">"styles/epub.css"</span></div><div class="line">          &#125;,</div><div class="line">          <span class="string">"mobi"</span>: &#123;</div><div class="line">            <span class="string">"title"</span>: <span class="string">"Stylesheet for Mobi output"</span>,</div><div class="line">            <span class="string">"default"</span>: <span class="string">"styles/mobi.css"</span></div><div class="line">          &#125;,</div><div class="line">          <span class="string">"ebook"</span>: &#123;</div><div class="line">            <span class="string">"title"</span>: <span class="string">"Stylesheet for ebook outputs (PDF, ePub, Mobi)"</span>,</div><div class="line">            <span class="string">"default"</span>: <span class="string">"styles/ebook.css"</span></div><div class="line">          &#125;,</div><div class="line">          <span class="string">"print"</span>: &#123;</div><div class="line">            <span class="string">"title"</span>: <span class="string">"Stylesheet to replace default ebook css"</span>,</div><div class="line">            <span class="string">"default"</span>: <span class="string">"styles/print.css"</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      <span class="string">"showLevel"</span>: &#123;</div><div class="line">        <span class="string">"type"</span>: <span class="string">"boolean"</span>,</div><div class="line">        <span class="string">"title"</span>: <span class="string">"Show level indicator in TOC"</span>,</div><div class="line">        <span class="string">"default"</span>: <span class="literal">false</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>可以在自己项目中的book.json中做自定义配置,譬如我希望使用项目根目录名为 <code>websiteStyle.css</code> 的样式文件覆盖默认主题在生成website时的部分样式,就可以:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"styles"</span>:&#123;</div><div class="line">        <span class="attr">"website"</span>:<span class="string">"./websiteStyle.css"</span></div><div class="line">    &#125;,</div><div class="line">    // ---忽略下面的部分---</div><div class="line">    "plugins": [</div><div class="line">        "-sharing",</div><div class="line">        "-fontsettings",</div><div class="line">        "-search",</div><div class="line">        <span class="string">"-lunr"</span></div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如此一来,我们在此配置的css就会作为站点样式在默认的样式之后加载.可以覆盖默认的css样式以达到自定义的目的.</p>
<h2 id="插件的形式定制新的Theme主题"><a href="#插件的形式定制新的Theme主题" class="headerlink" title="插件的形式定制新的Theme主题"></a>插件的形式定制新的Theme主题</h2><blockquote>
<p>下面示例使用github repo的形式创建一个gitbook的插件</p>
</blockquote>
<ul>
<li>首先,我们需要创建一个新的repo,然后在其中<code>npm init</code>初始化<code>package.json</code>配置文件.</li>
</ul>
<p>注意该配置文件中必须在<code>engines</code>中指明<code>gitbook</code>的版本<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">"engines": &#123;</div><div class="line">    "gitbook": "&gt;=3.2.2"</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果你想要自定义一些配置节点也可以在<code>package.json</code>中声明.<br>譬如,现在需要一个keywords的配置,是一个字符串值,用来指定页面渲染后的meta中的keywords,那么我们可以写作:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">   	"gitbook":&#123;</div><div class="line">	"properties":&#123;</div><div class="line">		"keywords":&#123;</div><div class="line">			"type":"string",</div><div class="line">			"default":"",</div><div class="line">			"description":"meta keywords config"</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>接下来在入口文件中可以使用插件机制提供的hook来获取指定的config:</li>
</ul>
<p>index.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    hooks: &#123;</div><div class="line">        config: <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">`config hook~\nconfig.keywords has a value:<span class="subst">$&#123;config[<span class="string">'keywords'</span>]&#125;</span>`</span>)</div><div class="line">            <span class="keyword">return</span> config</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>现在将这个简单的插件push到github,然后就可以在gitbook项目中使用了.我们只需要在项目的<code>book.json</code>中添加如下配置:</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">"plugins":["name@git+https://github.com/username/repo-name.git"]</div></pre></td></tr></table></figure>
<p>接下来,在<code>book.json</code>当前目录<code>gitbook install</code>安装该插件<br>插件安装完成后 <code>gitbook serve</code>启动服务器就可以按到我们的插件已经正常运行了</p>
<h2 id="提高开发时的效率"><a href="#提高开发时的效率" class="headerlink" title="提高开发时的效率"></a>提高开发时的效率</h2><p>虽然,上面我们使用了gitbook自带的插件机制将自定义的部分作为一个单独的插件库.<br>但是实际上开发的时候还是会感觉非常麻烦.<br>比如我改动一些样式,就必须要打包上传到github,然后到gitbook的项目中更新插件引用,然后再在本地host查看效果.</p>
<p>这样的一套流程显然是不能够满足我们的开发需求的.<br>所以需要在 <code>plugin</code> 项目中用gulp创建一个开发时的 watch 任务,监视开发目录的文件变动,然后打包替换到 <code>gitbook</code> 项目里的 <code>_book(默认的host目录)/gitbook/</code> 目录.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>)</div><div class="line"><span class="keyword">var</span> sass = <span class="built_in">require</span>(<span class="string">'gulp-sass'</span>)</div><div class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'gulp-postcss'</span>)</div><div class="line"><span class="keyword">var</span> autoprefixer = <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)</div><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack-stream'</span>)</div><div class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>)</div><div class="line"><span class="keyword">var</span> cssMinify = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>)</div><div class="line"><span class="keyword">var</span> through = <span class="built_in">require</span>(<span class="string">'through2'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> PATHS = &#123;</div><div class="line">    SASS: [<span class="string">'./src/scss/style.scss'</span>], <span class="comment">// scss 入口文件</span></div><div class="line">    SASS_ALL: [<span class="string">'./src/scss/**/*'</span>],</div><div class="line">    SCRIPTS: [<span class="string">'./src/js/**/index.js'</span>],</div><div class="line">    SCRIPTS_ALL: [<span class="string">'./src/js/**/*'</span>],</div><div class="line">    production: <span class="string">'./_assets/website/'</span>,</div><div class="line">    development: <span class="string">'../pdoc/node_modules/gitbook-plugin-polex/_assets/website/'</span>,</div><div class="line">    debug: <span class="string">'../pdoc/_book/gitbook/'</span>, <span class="comment">// 只适用在开发调试过程中 不需要重新host gitbook</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> getPath = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> ret = PATHS[process.env.NODE_ENV]</div><div class="line">    <span class="keyword">return</span> ret</div><div class="line">&#125;</div><div class="line"></div><div class="line">gulp.task(<span class="string">'compileSass'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">var</span> plugins = [autoprefixer(&#123;</div><div class="line">        browsers: [</div><div class="line">            <span class="string">"android 4"</span>,</div><div class="line">            <span class="string">"iOS 6"</span>,</div><div class="line">            <span class="string">"last 2 versions"</span></div><div class="line">        ]</div><div class="line">    &#125;)]</div><div class="line">    gulp.src(PATHS.SASS)</div><div class="line">        .pipe(sass().on(<span class="string">'error'</span>, sass.logError))</div><div class="line">        .pipe(postcss(plugins))</div><div class="line">        .pipe(cssMinify())</div><div class="line">        .pipe(gulp.dest(getPath()))</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'compileScript'</span>, () =&gt; &#123;</div><div class="line">    gulp.src(PATHS.SCRIPTS)</div><div class="line">        .pipe(through.obj(<span class="function"><span class="keyword">function</span>(<span class="params">file, enc, cb</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> __filename = file.path.split(<span class="string">'\\'</span>).reverse()[<span class="number">1</span>]</div><div class="line">            gulp.src(file.path)</div><div class="line">                .pipe(webpack(&#123;</div><div class="line">                    output: &#123;</div><div class="line">                        filename: __filename === <span class="string">'core'</span> ? <span class="string">'gitbook.js'</span> : <span class="string">'theme.js'</span></div><div class="line">                    &#125;,</div><div class="line">                    <span class="built_in">module</span>: &#123;</div><div class="line">                        loaders: [&#123;</div><div class="line">                            test: <span class="regexp">/\.js$/</span>,</div><div class="line">                            exclude: <span class="regexp">/node_modules/</span>,</div><div class="line">                            loader: <span class="string">'babel'</span>,</div><div class="line">                            query: &#123;</div><div class="line">                                presets: [<span class="string">'es2015'</span>]</div><div class="line">                            &#125;</div><div class="line">                        &#125;]</div><div class="line">                    &#125;</div><div class="line">                &#125;))</div><div class="line">                .pipe(gulp.dest(getPath()))</div><div class="line">            cb()</div><div class="line">        &#125;))</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'build'</span>, [<span class="string">'compileSass'</span>, <span class="string">'compileScript'</span>])</div><div class="line"></div><div class="line">gulp.task(<span class="string">'watch'</span>, [<span class="string">'compileSass'</span>, <span class="string">'compileScript'</span>], () =&gt; &#123;</div><div class="line">    gulp.watch(PATHS.SASS_ALL, [<span class="string">'compileSass'</span>])</div><div class="line">    gulp.watch(PATHS.SCRIPTS_ALL, [<span class="string">'compileScript'</span>])</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>在 <code>src/</code> 目录创建一个 <code>build.dev.sh</code> 脚本来完成打包替换的过程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#! /bin/bash</span></div><div class="line">ROOT=../pdoc/node_modules/gitbook-plugin-polex/</div><div class="line"></div><div class="line"><span class="comment"># Cleanup folder</span></div><div class="line">rm -rf <span class="variable">$&#123;ROOT&#125;</span>_assets</div><div class="line">rm -rf <span class="variable">$&#123;ROOT&#125;</span>_layouts</div><div class="line"></div><div class="line"><span class="comment"># Recreate folder</span></div><div class="line">mkdir -p <span class="variable">$&#123;ROOT&#125;</span>_assets/website/</div><div class="line"></div><div class="line"><span class="comment"># Copy layouts</span></div><div class="line">cp -R _layouts/ <span class="variable">$&#123;ROOT&#125;</span>_layouts</div><div class="line"></div><div class="line"><span class="comment"># Copy fonts</span></div><div class="line">mkdir -p <span class="variable">$&#123;ROOT&#125;</span>_assets/website/fonts</div><div class="line">cp -R node_modules/font-awesome/fonts/ <span class="variable">$&#123;ROOT&#125;</span>_assets/website/fonts/fontawesome/</div><div class="line"></div><div class="line"><span class="comment"># Packaged via Gulp</span></div><div class="line">cross-env NODE_ENV=development gulp build</div><div class="line"></div><div class="line"><span class="comment"># Copy images if they exist</span></div><div class="line">mkdir -p <span class="variable">$&#123;ROOT&#125;</span>_assets/website/images</div><div class="line">imgs=`du -k <span class="string">"src/images"</span> | cut -f 1` </div><div class="line">zero=0</div><div class="line"><span class="keyword">if</span> [ <span class="variable">$imgs</span> -gt <span class="variable">$zero</span> ]; <span class="keyword">then</span></div><div class="line">cp src/images/*.* <span class="variable">$&#123;ROOT&#125;</span>_assets/website/images/</div><div class="line"><span class="keyword">else</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"没有图片要复制."</span></div><div class="line"><span class="built_in">exit</span> 0</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<h2 id="自动扫描目录生成SUMMARY-md文件"><a href="#自动扫描目录生成SUMMARY-md文件" class="headerlink" title="自动扫描目录生成SUMMARY.md文件"></a>自动扫描目录生成SUMMARY.md文件</h2><h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><ul>
<li>扫描文件目录,获取文件列表</li>
<li>循环文件列表读取文件内容<ul>
<li>将文件内容拆分成行</li>
<li>正则匹配标题行<ul>
<li>获取标题深度</li>
<li>生成hash锚点</li>
</ul>
</li>
<li>重新写入生成后的内容到md文件</li>
<li>根据标题/标题深度/锚点生成SUMMARY.md结构描述文件</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob'</span>);   <span class="comment">// file scanner lib</span></div><div class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">const</span> borschikHash = <span class="built_in">require</span>(<span class="string">'borschik-hash'</span>);  <span class="comment">// hash generator lib</span></div><div class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'../config/server.json'</span>);    <span class="comment">// locale config</span></div><div class="line"><span class="keyword">const</span> DOC_DIR = config.build.dirs.subjects;</div><div class="line"></div><div class="line"><span class="keyword">let</span> titleReg = <span class="regexp">/^#+\s([^\n\&#123;#\&#125;]+)/gi</span>;</div><div class="line"><span class="keyword">let</span> titleHashReg = <span class="regexp">/\&#123;#([\w\W]+)\&#125;/</span>;</div><div class="line"><span class="keyword">let</span> structureMetaData = [];</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * generate the content of summary.md</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">let</span> generateContent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (structureMetaData.length &gt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">let</span> contentArr = [<span class="string">'# SUMMARY\n\n'</span>];</div><div class="line">    <span class="keyword">let</span> _index = contentArr.length;</div><div class="line">    structureMetaData.forEach(<span class="function"><span class="params">meta</span> =&gt;</span> &#123;</div><div class="line">      contentArr[_index++] = <span class="string">`<span class="subst">$&#123;<span class="string">' '</span>.repeat(meta[<span class="string">'depth'</span>] * <span class="number">4</span>)&#125;</span>`</span>; <span class="comment">// indents of menu depth level</span></div><div class="line">      <span class="keyword">if</span> (meta.hash) &#123;</div><div class="line">        contentArr[_index++] = <span class="string">`* [<span class="subst">$&#123;meta.title&#125;</span>](./<span class="subst">$&#123;meta.filepath&#125;</span>#<span class="subst">$&#123;meta.hash&#125;</span>)`</span>;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        contentArr[_index++] = <span class="string">`* [<span class="subst">$&#123;meta.title&#125;</span>](./<span class="subst">$&#123;meta.filepath&#125;</span>)`</span>;</div><div class="line">      &#125;</div><div class="line">      contentArr[_index++] = <span class="string">'\n'</span>;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> contentArr.join(<span class="string">''</span>);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">console</span>.error(<span class="string">`未读取到有效的 markdown 目录结构信息.`</span>);</div><div class="line">    process.exit(<span class="number">-1</span>);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Rewrite the content into file</span></div><div class="line"><span class="comment"> * @param &#123;string&#125; filepath</span></div><div class="line"><span class="comment"> * @param &#123;string&#125; content</span></div><div class="line"><span class="comment"> * @param &#123;string&#125; encoding</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">let</span> rewriteFile = <span class="function"><span class="keyword">function</span>(<span class="params">filepath, content = <span class="string">''</span>, encoding = <span class="string">'utf-8'</span></span>) </span>&#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">if</span> (fs.existsSync(filepath)) &#123;</div><div class="line">      fs.unlinkSync(filepath);</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">    <span class="built_in">console</span>.error(e.message);</div><div class="line">  &#125; <span class="keyword">finally</span> &#123;</div><div class="line">    fs.writeFile(filepath, content, encoding, (err) =&gt; &#123;</div><div class="line">      <span class="keyword">if</span> (err) &#123;</div><div class="line">        <span class="built_in">console</span>.error(err.message);</div><div class="line">        process.exit(<span class="number">-1</span>);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Create summary.md</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">let</span> generateSummaryFile = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> filepath = path.join(__dirname, DOC_DIR, <span class="string">'SUMMARY.md'</span>);</div><div class="line">  rewriteFile(filepath, generateContent());</div><div class="line">&#125;;</div><div class="line"></div><div class="line">glob(<span class="string">"**/*.md"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, files</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (err) &#123;</div><div class="line">    <span class="built_in">console</span>.error(err.message);</div><div class="line">    process.exit(<span class="number">-1</span>);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    files.forEach(<span class="function"><span class="params">filepath</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">let</span> absoluteFilePath = path.join(__dirname, DOC_DIR, filepath);</div><div class="line">      <span class="keyword">let</span> originContent = fs.readFileSync(absoluteFilePath, <span class="string">'utf-8'</span>);</div><div class="line"></div><div class="line">      <span class="comment">/**</span></div><div class="line"><span class="comment">       * If the content is not empty,</span></div><div class="line"><span class="comment">       * try to split it into lines.</span></div><div class="line"><span class="comment">       * then get the titleReg-matched lines,</span></div><div class="line"><span class="comment">       * ensure that each of them has an unique anchor name,</span></div><div class="line"><span class="comment">       * no matter whether they were linked or not,</span></div><div class="line"><span class="comment">       * cause we need 2 generate the summary menus and they need hash</span></div><div class="line"><span class="comment">       */</span></div><div class="line">      <span class="keyword">if</span> (originContent.length &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">let</span> lines = originContent.split(<span class="string">'\n'</span>);</div><div class="line">        <span class="keyword">let</span> newLines = lines.map(<span class="function"><span class="params">lineContent</span> =&gt;</span> &#123;</div><div class="line">          <span class="keyword">let</span> title = filepath.split(<span class="string">'/'</span>).reverse()[<span class="number">0</span>];</div><div class="line">          <span class="keyword">let</span> hash = <span class="literal">null</span>;</div><div class="line">          <span class="keyword">let</span> depth = <span class="number">0</span>;</div><div class="line">          <span class="keyword">let</span> _title = titleReg.exec(lineContent);</div><div class="line">          <span class="keyword">let</span> _hash = titleHashReg.exec(lineContent);</div><div class="line"></div><div class="line">          <span class="keyword">if</span> (_title &amp;&amp; _title.length &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// depth begins from 0</span></div><div class="line">            <span class="comment">// which means it is just one less than the amount of '#' in front of the line</span></div><div class="line">            depth = _title[<span class="number">0</span>].split(<span class="regexp">/\s/ig</span>)[<span class="number">0</span>].length - <span class="number">1</span>;</div><div class="line">            title = _title[_title.length - <span class="number">1</span>].trim();</div><div class="line"></div><div class="line">            <span class="comment">// generate the hash anchors for the titles those don't have any anchor</span></div><div class="line">            <span class="keyword">if</span> (_hash &amp;&amp; _hash.length &gt; <span class="number">0</span>) &#123;</div><div class="line">              hash = _hash[_hash.length - <span class="number">1</span>].trim();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">              <span class="comment">// append the hash code to the end of line</span></div><div class="line">              hash = borschikHash(title);</div><div class="line">              lineContent = <span class="string">`<span class="subst">$&#123;lineContent&#125;</span> &#123;#<span class="subst">$&#123;hash&#125;</span>&#125;`</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// the meta data of the structures for the summary.md</span></div><div class="line">            structureMetaData[structureMetaData.length] = &#123;</div><div class="line">              filepath,</div><div class="line">              title,</div><div class="line">              depth,</div><div class="line">              hash</div><div class="line">            &#125;;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">return</span> lineContent;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        <span class="comment">// rewirte the new content into file</span></div><div class="line">        <span class="keyword">let</span> fileContent = newLines.join(<span class="string">'\n'</span>);</div><div class="line">        rewriteFile(filepath, fileContent);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    generateSummaryFile();</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/my-blog/2016/10/01/好玩的社区/">
                好玩的社区
            </a>
        </h1>
        <div class="post-info">
            <span class="date">2016-10-01</span>
            
            
        </div>
    </div>

    
        <div class="content">
            <blockquote>
<p>以下是个人搜罗的一些比较喜欢的社区,比起传统的 csdn 和 open-open 那种技术性论坛和博客,这里给我的感觉更像是家.</p>
</blockquote>
        </div>
        <a href="/my-blog/2016/10/01/好玩的社区/" class="read-more">Read More</a>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/my-blog/2016/09/28/踩过的坑/">
                踩过的坑
            </a>
        </h1>
        <div class="post-info">
            <span class="date">2016-09-28</span>
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h1><h2 id="IE-系列"><a href="#IE-系列" class="headerlink" title="IE 系列"></a>IE 系列</h2><ul>
<li>IE11在跨站引用的样式文件中的url(比如字体文件路径)解析时,会将document文档的域作为当前域,而不是该样式文件的域.</li>
<li>在IE8中使用respond.js去使之支持css3媒体查询的时候,值得注意的是<strong>respond默认不会加载跨域样式资源</strong>,</li>
<li>在IE8中实现数据可视化,千万不要用基于canvas绘图的插件+excanvas,这是自寻死路.还是找找svg+vml绘图的插件吧,比如highcharts之类的.效率问题.</li>
</ul>
<h2 id="Ajax-CORS"><a href="#Ajax-CORS" class="headerlink" title="Ajax/CORS"></a>Ajax/CORS</h2><ul>
<li>XMLHttpRequest的<code>setRequestHeader</code>要在<code>open</code>后进行</li>
<li>在跨域的POST请求,需要携带cookie身份信息时,XMLHttpRequest的<code>withCredentials</code>要在<code>open</code>后,设置为<code>true</code>(对应的,服务器要有<code>Access-Control-Allow-Credentials: true</code>的responseHeader)</li>
<li>XHR的同步请求中不能设置timeout,否则会报错</li>
<li>XHR的ontimeout,onabort,onerror等等事件在onreadystatechange事件执行后才会触发 所以如果要reject结果的话,需要 setTimeout 0 将其延迟到下一tick</li>
</ul>
        </div>
        <a href="/my-blog/2016/09/28/踩过的坑/" class="read-more">Read More</a>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/my-blog/2016/09/28/工具使用/">
                工具使用
            </a>
        </h1>
        <div class="post-info">
            <span class="date">2016-09-28</span>
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h1><h2 id="生成ssh"><a href="#生成ssh" class="headerlink" title="生成ssh"></a>生成ssh</h2><pre><code>- 配置全局设置 `git config --global user.name &quot;username&quot;` `git confgi --global user.email &quot;example@xxx.com&quot;`
- 生成ssh `ssh-keygen -t rsa -C &quot;example@xxx.com&quot;` 会在C:\User\xxx目录下生成.ssh目录
- 将生成的.ssh目录中的id_rsa.pub的内容添加到gitlab/github的个人账户的ssh-key
- 验证 ssh 是否添加成功 `ssh git@github.com`
</code></pre><h2 id="解决git-clone时文件目录过长的方法"><a href="#解决git-clone时文件目录过长的方法" class="headerlink" title="解决git clone时文件目录过长的方法"></a>解决git clone时文件目录过长的方法</h2><pre><code>修改git设置 `git config --system core.longpaths true`
</code></pre><h2 id="解决-git-review-时-no-matching-key-exchange-method-found-Their-offer-diffie-hellman-group1-sha1-的错误"><a href="#解决-git-review-时-no-matching-key-exchange-method-found-Their-offer-diffie-hellman-group1-sha1-的错误" class="headerlink" title="解决 git review 时 no matching key exchange method found. Their offer: diffie-hellman-group1-sha1 的错误"></a>解决 git review 时 no matching key exchange method found. Their offer: diffie-hellman-group1-sha1 的错误</h2><p>该错误是由于服务器ssh验证使用了一个过时的算法导致的,但是为了能够成功通过,需要在bash每次打开时设置一下 <a href="http://stackoverflow.com/questions/38770202/using-kexalgorithms-diffie-hellman-group1-sha1-did-not-resolve-no-matching-ke" target="_blank" rel="external">stackoverflow solution</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> GIT_SSH_COMMAND=<span class="string">'ssh -o KexAlgorithms=+diffie-hellman-group1-sha1'</span></div></pre></td></tr></table></figure>
<p>stackoverflow上有热心人说可以在 git config 中做配置,但是我试了,并没有什么用,不过还是记录一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">git config --global core.sshCommand <span class="string">"ssh -o KexAlgorithms=+diffie-hellman-group1-sha1"</span></div><div class="line">git config --global core.scpCommand <span class="string">"scp -o KexAlgorithms=+diffie-hellman-group1-sha1"</span></div></pre></td></tr></table></figure>
        </div>
        <a href="/my-blog/2016/09/28/工具使用/" class="read-more">Read More</a>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/my-blog/2016/09/28/奇技淫巧/">
                奇技淫巧
            </a>
        </h1>
        <div class="post-info">
            <span class="date">2016-09-28</span>
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="generator-生成i内的-fibonacci数组"><a href="#generator-生成i内的-fibonacci数组" class="headerlink" title="generator 生成i内的 fibonacci数组"></a>generator 生成i内的 fibonacci数组</h1><pre><code>let i = 1000;
[...(function(limit){ 
    return function* (){
        let [prev, curr] = [0,1]
        while(prev + curr &lt; limit){
            [prev, curr] = [curr, prev + curr]
            yield curr
        }
    }
})(i)()]
</code></pre>
        </div>
        <a href="/my-blog/2016/09/28/奇技淫巧/" class="read-more">Read More</a>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/my-blog/2016/01/21/Chat Server/">
                Chat聊天服务器架设历程
            </a>
        </h1>
        <div class="post-info">
            <span class="date">2016-01-21</span>
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="Chat聊天服务器架设历程"><a href="#Chat聊天服务器架设历程" class="headerlink" title="Chat聊天服务器架设历程"></a>Chat聊天服务器架设历程</h1><hr>
<h2 id="2015年11月3日-13-16-20-在Github上找到了Lets-chat项目"><a href="#2015年11月3日-13-16-20-在Github上找到了Lets-chat项目" class="headerlink" title="2015年11月3日 13:16:20 在Github上找到了Lets chat项目"></a>2015年11月3日 13:16:20 在Github上找到了Lets chat项目</h2><p><strong>首先安装了说明上的依赖</strong>  </p>
<p>nodejs 0.10+<br>MongoDB 2.6+<br>Python 2.7.x</p>
<p><strong>然后将项目clone到本地目录</strong>  </p>
<p>git clone <a href="https://github.com/sdelements/lets-chat.git">https://github.com/sdelements/lets-chat.git</a></p>
<p><strong>安装项目依赖</strong>  </p>
<p>cd lets-chat  </p>
<p>npm install</p>
        </div>
        <a href="/my-blog/2016/01/21/Chat Server/" class="read-more">Read More</a>
    

</div>
            
        </section>
    </div>
</div>






</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>关于</h2>
                <p>
                    如果有问题欢迎提ISSUE
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>最近发布</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/my-blog/2018/03/15/常用指令/">常用指令</a>
            </li>
            
            <li>
                <a class="footer-post" href="/my-blog/2017/05/12/面试题/">有趣的面试题</a>
            </li>
            
            <li>
                <a class="footer-post" href="/my-blog/2017/03/02/Gitbook定制/">Gitbook定制</a>
            </li>
            
            <li>
                <a class="footer-post" href="/my-blog/2016/10/01/好玩的社区/">好玩的社区</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/marsoln/my-blog">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/marsoln1988">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:marsoln1988@gmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    Hexo & Alpha-Dust What A Magic! ❤ by Marsoln
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/my-blog/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>